<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="Description" content="Enter your description here" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <title>OTT Buddy</title>
</head>

<body>
    <!-- add new OTT show modal -->

    <div class="modal fade add_data" id="addOTTModal" tabindex="-1" aria-labelledby="addOTTModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addOTTModalLabel">Add New OTT Show</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
						<label>OTT</label>
						<input type="text" class="form-control OTT_name" placeholder = "Enter OTT name here" required="">
					</div>
					<div class="form-group">
						<label>Show</label>
						<input type="email" class="form-control show_name" placeholder="Enter show name here" required="">
					</div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success submit">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- add new OTT show modal end -->

    <!-- edit OTT modal start -->

    <div class="modal fade edit_modal" id="editOTTModal" tabindex="-1" aria-labelledby="editOTTModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editOTTModalLabel">Edit OTT Show</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
						<label>OTT</label>
						<input type="text" class="form-control edit_OTT_name" required="">
					</div>
					<div class="form-group">
						<label>Show</label>
						<input type="email" class="form-control edit_show_name" required="">
					</div>
                    <input type="hidden" class = "edit_key">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success save_edited_data">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- edit OTT modal end -->

    <!-- hero section starts from here -->

    <section id="hero">
        <div class="main_container">
            <div class="head">
                <div class="left">
                    <h5>OTT <span class="">Buddy</span></h5>
                </div>
                <div class="right">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addOTTModal">
                        Add new show
                    </button>
                </div>
            </div>
            <div class="body">
                <div class="table-responsive">
                    <table class="table">
                        <thead class="thead-dark">
                            <tr>
                                <th scope="col">OTT</th>
                                <th scope="col">Show</th>
                                <th scope="col">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            
                        </tbody>
                    </table>
                </div>
                
            </div>
        </div>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-database.js"></script> 
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCXm9N8-WdSFemEhNDVPSU1hFGMELdHBFg",
            authDomain: "ott-buddy.firebaseapp.com",
            databaseURL: "https://ott-buddy-default-rtdb.firebaseio.com",
            projectId: "ott-buddy",
            storageBucket: "ott-buddy.appspot.com",
            messagingSenderId: "336993760040",
            appId: "1:336993760040:web:74f3bc87e474d51081561d"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const dbRef = firebase.database().ref();
        const listShowsRef = dbRef.child('list_shows');
        listShowsRef.on("child_added",snap =>{
           $("table tbody").append(
               `<tr data-id=`+snap.key+`> 
                    <td>`+snap.val().OTT+`</td>
                    <td>`+snap.val().show+`</td>
                    <td>
                        <a href="#editOTTModal" class="edit" data-toggle="modal">
                            <i class="material-icons edit_icon" data-toggle="tooltip" title="Edit">&#xE254;</i>
                        </a>
                        <a href="#deleteOTTModal" class="delete" data-toggle="modal">
                            <i class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i>
                        </a>
                    </td>
                </tr>`
           )
        });
        $(document).ready(function(){
            $(".add_data .submit").on("click",function(){
                const OTT_name = $(".add_data .OTT_name").val(); 
                const show_name = $(".add_data .show_name").val(); 
                const new_data = {
                    OTT:OTT_name,
                    show:show_name
                }
                listShowsRef.push(new_data,function(){
                    console.log("new data added");
                });
                $(".add_data .OTT_name").val("");
                $(".add_data .show_name").val("");
            });
            $(".save_edited_data").on("click",function(){
                var edited_OTT_name = $(".edit_modal .edit_OTT_name").val();
                var edited_show_name = $(".edit_modal .edit_show_name").val();
                var edited_key = $(".edit_modal .edit_key").val();
                const editedData = {
                    OTT:edited_OTT_name,
                    show:edited_show_name
                }
                var listShowRef = dbRef.child('list_shows/'+edited_key).update(editedData);
                
            })
        })
        $(document).on("click",".edit",function(){
            var key = $(this).parent().parent().data("id");
            var listShowRef = dbRef.child('list_shows/'+key);
            listShowRef.on("value",snap => {
                $(".edit_modal .edit_OTT_name").val(snap.val().OTT);
                $(".edit_modal .edit_show_name").val(snap.val().show);
                $(".edit_modal .edit_key").val(snap.key);
            })
        })
        $(document).on("click",".delete",function(){
            var delete_key = $(this).parent().parent().data("id");
            var listShowRef = dbRef.child('list_shows/'+delete_key).remove();
            var element = $(this).parent().parent().hide();
        })
        
    </script>
    <script src="assets/js/index.js"></script>
</body>

</html>